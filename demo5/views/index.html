<% include header.html %>


<div class="row">
	<h1>날씨 조회</h1>	

	<form class="form-horizontal well">
		<div class="form-group">
			<label class="control-label col-sm-2">주소</label>
			<div class="col-sm-8">
				<input type="text" class="form-control" name="address" required />
			</div>
			<div class="col-sm-2">
				<button type="submit" class="btn btn-success">조회</button>
			</div>
		</div>
	</form>
	
</div>

<div class="row">
	<div class="panel pane-default">
		<div class="panel-body" id="currently-box">현재 기온: </div>
		<div class="panel-body" id="daily-box">
			<table class="table table-bordered table-striped">
				<thead>
					<tr>
						<th>Date</th>
						<th>Weather</th>
						<th>Temperature Min</th>
						<th>Temperature Max</th>
						<th>Summary</th>
					</tr>
				</thead>
				<tbody></tbody>
			</table>
		</div>
	</div>

</div>

<script>
	$(function() {


		$('table').hide();

		$('form').on('submit', function(event) {
			event.preventDefault();

			var address = $.trim($('input[name=address]').val());
			$("#currently-box").text("Loading...");

			var request = $.ajax({
				url:"/"+address,
				dataType:'json'
			});

			request.done(function(data) {

				var skycons = new Skycons({"color": "black"});

				var currentTemperature = data.current;
				$("#currently-box").text('현재 기온: 섭씨 ' + currentTemperature + " 도");

				$('table').show();
				var $dailybox = $("#daily-box tbody").empty();

				$.each(data.daily, function(index, item) {

					var icon = item.icon.toUpperCase().replace(/-/g, '_');

					var $tr = $("<tr></tr>");
					$tr.append('<td>'+item.day+'</td>');
					$tr.append('<td><canvas width="32" height="32" id="icon-'+index+'"></td>');
					$tr.append('<td>'+item.min+' 도</td>');
					$tr.append('<td>'+item.max+' 도</td>');
					$tr.append('<td>'+item.summary+'</td>');
					$dailybox.append($tr);

					skycons.add(document.getElementById("icon-" + index), Skycons[icon]);

				});

				skycons.play();

			});
			request.fail(function() {
				$("#viecurrentlyw-box").text('Error!');
				$('table').hide();
			})
		})
	});

</script>

<% include footer.html %>